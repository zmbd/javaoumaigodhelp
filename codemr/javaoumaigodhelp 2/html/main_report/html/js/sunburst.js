codemr.sunburst=function(){metricChartManagerForClass=codemr.metricchart("class-metric-chart",classMetricSpec,classMetricValues),metricChartManagerForPackage=codemr.metricchart("package-metric-chart",packageMetricSpec,packageMetricValues),codemr.sunburst.paintCallBack=function(){x.style("fill",(function(t){return f(t)}))};var t=!1,e=!1,n=1,r=14,a=0,i=null,o=800,c=800,s=Math.min(o,c)/2,u=d3.scale.linear().range([0,2*Math.PI]),l=d3.scale.linear().range([0,s]),d=(d3.scale.category20c(),!0);d3.select("#sunburst-chart-body").on("mousemove",(function(){d||(metricChartManagerForClass.setVisible(!1),metricChartManagerForPackage.setVisible(!1)),d=!1}));var m=d3.select("#sunburst-chart-body").append("svg").attr("width",o).attr("height",c).attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 800 800").append("g").attr("transform","translate("+o/2+","+c/2+")"),p=d3.layout.partition().value((function(t){return t.value})),h=d3.svg.arc().startAngle((function(t){return Math.max(0,Math.min(2*Math.PI,u(t.x)))})).endAngle((function(t){return Math.max(0,Math.min(2*Math.PI,u(t.x+t.dx)))})).innerRadius((function(t){return Math.max(0,l(t.y))})).outerRadius((function(t){return Math.max(0,l(t.y+t.dy))}));function f(t){return EQ_GET_COLOR(t)}function g(e){return t||a+1>=e.depth==0||null!=i&&0==y(i,e)||Math.max(0,l(e.y))*(Math.min(2*Math.PI,u(e.x+e.dx))-Math.min(2*Math.PI,u(e.x)))<r?"hidden":"visible"}function v(t){if(a+1>=t.depth){if(0===n)return t.name;var e=t.name,r=e.indexOf(".");if(1===n)return e.substring(r+1);var i=e.indexOf(".",r+1);if(2===n)return e.substring(i+1);var o=e.indexOf(".",i+1);return e.substring(o+1)}return""}function y(t,e){return t===e||!!t.children&&t.children.some((function(t){return y(t,e)}))}var b=d3.select("#sunburst-tooltip");root=EQ_GET_DATA();{var M=m.selectAll("g").data(p.nodes(root)).enter().append("g");d3.select("g").append("svg:image").attr("x",-78).attr("y",-78).attr("width",156).attr("height",156).on("mouseover",(function(){d3.select(this).moveToBack()}));var x=M.append("path").attr("d",h).style("fill",(function(t){return f(t)})).on("click",E).on("mouseover",P).on("mouseout",_).on("mousemove",k),C=M.append("text").attr("text-anchor",(function(t){return T(t)?"start":"end"})).attr("pointer-events","none").attr("transform",(function(t){return"rotate("+R(t)+")translate("+l(t.y)+")rotate("+(T(t)?"0":"-180")+")"})).attr("dx",(function(t){return T(t)?"5":"-5"})).attr("dy",".35em").text(v).style("visibility",(function(t){return g(t)})).on("click",E).on("mouseover",P).on("mouseout",_).on("mousemove",k);function E(t){i!==t&&(a=t.depth,i=t,C.transition().attr("opacity",0).style("visibility",(function(t){return g(t)})).style("pointer-events","none"),x.transition().duration(750).attrTween("d",function(t){var e=d3.interpolate(u.domain(),[t.x,t.x+t.dx]),n=d3.interpolate(l.domain(),[t.y,1]),r=d3.interpolate(l.range(),[t.y?20:0,s]);return function(t,a){return a?function(e){return h(t)}:function(a){return u.domain(e(a)),l.domain(n(a)).range(r(a)),h(t)}}}(t)).each("end",(function(e,n){if(e.x>=t.x&&e.x<t.x+t.dx){var r=d3.select(this.parentNode).select("text");r.transition().duration(750).attr("opacity",1).attr("text-anchor",(function(t){return T(t)?"start":"end"})).attr("transform",(function(){return"rotate("+R(e)+")translate("+l(e.y)+")rotate("+(T(e)?"0":"-180")+")"})).attr("dx",(function(t){return T(t)?"5":"-5"})),r.text(v).style("visibility",(function(t){return g(t)}))}})))}function k(t){b.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px"),V(t),function(t){d=!0,elem=document.getElementById("sunburst-chart-body"),boundingRect=elem.getBoundingClientRect();var e=o,n=c;V(t);var r=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,i=d3.event.pageX,s=d3.event.pageY,u=metricChartManagerForClass.getWidth();if(d3.event.pageX>boundingRect.left+e/2){var l=r-i;i<u&&(l=r-u),d3.select("#sunburst-tooltip").style("right",l+"px"),d3.select("#sunburst-tooltip").style("left","auto")}else{var m=i;i+u>r&&(m=r-u),d3.select("#sunburst-tooltip").style("left",m+"px"),d3.select("#sunburst-tooltip").style("right","auto")}d3.event.pageY>boundingRect.top+n/2?(d3.select("#sunburst-tooltip").style("bottom",a-s+"px"),d3.select("#sunburst-tooltip").style("top","auto")):(d3.select("#sunburst-tooltip").style("top",s+"px"),d3.select("#sunburst-tooltip").style("bottom","auto"))}(t)}function V(t){d3.event.ctrlKey||d3.event.metaKey?!function(t){return!t.children}(t)?function(t){return!(!t.children||!t.parent)}(t)&&(metricChartManagerForClass.setVisible(!1),metricChartManagerForPackage.setVisible(!0)):(metricChartManagerForClass.setVisible(!0),metricChartManagerForPackage.setVisible(!1)):(metricChartManagerForClass.setVisible(!1),metricChartManagerForPackage.setVisible(!1))}d3.select("g g").transition().duration(200).attr("opacity","0"),d3.select("g g").transition().duration(200).attr("opacity","1"),d3.selection.prototype.moveToBack=function(){return this.each((function(){var t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)}))};var F=null;function P(t){return b.select("#name").html((function(){var e=function(t){return"<b>"+t.name+"</b><br>"+EQ_getSelectedMetricName(t)+":"+EQ_GET_METRICVALUE(t)+"<br>Level:"+EQ_GET_METRIC_LEVEL_STR(t)}(t);return e})),F!==t&&(t.metrics?metricChartManagerForClass.updateMetricValues(EQ_convertMetricValues(t.metricvalues)):t.pmetrics&&metricChartManagerForPackage.updateMetricValues(EQ_convertMetricValues(t.pmetricvalues)),F=t,"function"==typeof updateSelectedElement&&t.parent&&(t.key?updateSelectedElement(t.parent.name,t.key):updateSelectedElement(t.name,""))),V(t),b.transition().duration(50).style("opacity",.9)}function _(t){e}}function R(t){return t===i||0===a&&0===t.depth?0:(u(t.x+t.dx/2)-Math.PI/2)/Math.PI*180}function T(t){var e=R(t);return e<0&&(e+=360),!(e>90&&e<=270)}d3.select(self.frameElement).style("height","850px")};
