codemr.circlepack=function(){var e=codemr.metricchart("class-metric-chart",classMetricSpec,classMetricValues),t=codemr.metricchart("package-metric-chart",packageMetricSpec,packageMetricValues);codemr.circlepack.paintCallBack=function(){f.style("fill",(function(e){return e.children?"#C6DCEC":r(e)})),f.selectAll("title").text((function(e){return e.name+" "+EQ_getSelectedMetricName(e)+" "+EQ_GET_METRICVALUE(e)}))};var n=1,c=800;function r(e){return EQ_GET_COLOR(e)}function i(e){if(0===n)return e.name;var t=e.name,c=t.indexOf(".");if(1===n)return t.substring(c+1);var r=t.indexOf(".",c+1);if(2===n)return t.substring(r+1);var i=t.indexOf(".",r+1);return t.substring(i+1)}var l=d3.layout.pack().padding(2).size([c-20,c-20]).value((function(e){return e.value})).sort((function(e,t){var n;n=t.value-e.value;return n}));var a=d3.select("#circle-chart-body").append("div").attr("class","circlepackchart").append("svg").attr("width",c).attr("height",c).append("g").attr("transform","translate("+c/2+","+c/2+")");root=EQ_GET_DATA();{var o,s=root,u=l.nodes(root),d=a.selectAll("circle").data(u).enter().append("circle"),p=null,f=d.attr("class",(function(e){return e.parent?e.children?"node":"node node--leaf":"node node--root"})).style("fill",(function(e){return e.children?"#C6DCEC":r(e)})).style("fill-opacity",(function(e){return e.children?"0.5":"0.9"})).style("stroke",(function(e){return"#000"})).on("click",(function(e){s!==e&&(v(e),d3.event.stopPropagation())})).on("mousemove",(function(n){p!==n&&(n.metrics?e.updateMetricValues(EQ_convertMetricValues(n.metricvalues)):n.pmetrics&&t.updateMetricValues(EQ_convertMetricValues(n.pmetricvalues)),p=n,"function"==typeof updateSelectedElement&&n.parent&&(n.key?updateSelectedElement(n.parent.name,n.key):updateSelectedElement(n.name,""))),g(n),function(t){movingOnElement=!0,elem=document.getElementById("circle-chart-body"),boundingRect=elem.getBoundingClientRect();var n=c,r=c,i=e.getWidth();g(t);var l=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=d3.event.pageX,s=d3.event.pageY;if(d3.event.pageX>boundingRect.left+n/2){var u=l-o;o<i&&(u=l-i),d3.select("#circle-pack-tooltip").style("right",u+"px"),d3.select("#circle-pack-tooltip").style("left","auto")}else{var d=o;o+i>l&&(d=l-i),d3.select("#circle-pack-tooltip").style("left",d+"px"),d3.select("#circle-pack-tooltip").style("right","auto")}d3.event.pageY>boundingRect.top+r/2?(d3.select("#circle-pack-tooltip").style("bottom",a-s+"px"),d3.select("#circle-pack-tooltip").style("top","auto")):(d3.select("#circle-pack-tooltip").style("top",s+"px"),d3.select("#circle-pack-tooltip").style("bottom","auto"))}(n)}));d.append("title").text((function(e){return e.name+" "+EQ_getSelectedMetricName(e)+" "+EQ_GET_METRICVALUE(e)}));var m=a.selectAll("text").data(u).enter().append("text");m.attr("class","circlelabel").style("display",(function(e){return e.parent===root?null:"none"})).text((function(e){return i(e)}));m.append("title").text((function(e){return e.name+" "+EQ_getSelectedMetricName(e)+" "+EQ_GET_METRICVALUE(e)}));var y=a.selectAll("circle,text");function v(e){s=e,d3.transition().duration(d3.event.altKey?7500:750).tween("zoom",(function(e){var t=d3.interpolateZoom(o,[s.x,s.y,2*s.r+20]);return function(e){h(t(e))}})).selectAll("text").filter((function(e){return!!e&&(e.parent===s||"inline"===this.style.display)})).style("fill-opacity",(function(e){return e.parent===s?1:0})).each("start",(function(e){e.parent===s&&(this.style.display="inline")})).each("end",(function(e){e.parent!==s&&(this.style.display="none")})),e.metrics&&eQ.MetricChart.updateDots(e.metrics,i(e))}d3.select("body").on("click",(function(){v(root)})),h([root.x,root.y,2*root.r+20])}function h(e){var t=c/e[2];o=e,y.attr("transform",(function(n){return"translate("+(n.x-e[0])*t+","+(n.y-e[1])*t+")"})),f.attr("r",(function(e){return e.r*t}))}function g(n){d3.event.ctrlKey||d3.event.metaKey?!function(e){return!e.children}(n)?function(e){return!(!e.children||!e.parent)}(n)&&(e.setVisible(!1),t.setVisible(!0)):(e.setVisible(!0),t.setVisible(!1)):(e.setVisible(!1),t.setVisible(!1))}d3.select(self.frameElement).style("height","850px")};
